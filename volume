#!/bin/bash
set -e

DATA_DIR="${1:-./data}"
PORT="${PORT:-3000}"
MASTER="${MASTER:-}"

if [ ! -f "./minivault" ]; then
    echo "Building minivault..."
    go build -o minivault src/*.go
fi

mkdir -p "$DATA_DIR"

if [ -n "$MASTER" ]; then
    exec ./minivault -port "$PORT" -data "$DATA_DIR" -master "$MASTER"
else
    exec ./minivault -port "$PORT" -data "$DATA_DIR"
fi
